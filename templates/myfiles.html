{% extends 'base.html' %}
{% block content %}

<style>
/* ================= GLOBAL & LAYOUT ================= */
* {
    box-sizing: border-box;
    font-family: 'Inter', sans-serif; /* Recommended for this look */
}

.main-content {
    background-color: #f8fafc;
    min-height: 100vh;
    padding: 24px 40px;
    width: 100%;
}

.files-page {
    max-width: 1400px;
    margin: 0;
}

/* ================= HEADER ================= */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 32px;
}

.page-title h1 {
    font-size: 28px;
    font-weight: 700;
    color: #1e293b;
    margin: 0;
}

.page-title p {
    color: #64748b;
    font-size: 14px;
    margin-top: 4px;
}

.upload-btn {
    background: #6366f1;
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* ================= STATS BAR ================= */
.stats-bar {
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 16px;
    padding: 20px;
    display: flex;
    gap: 40px;
    margin-bottom: 24px;
}

.stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
}

.stat strong {
    font-size: 20px;
    color: #1e293b;
}

.stat span {
    font-size: 12px;
    color: #94a3b8;
    margin-top: 4px;
}

/* ================= FILTERS ================= */
.filters {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.search-box {
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 10px 16px;
    width: 400px;
    font-size: 14px;
}

.filter-group {
    display: flex;
    gap: 12px;
}

.select {
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    padding: 8px 16px;
    background: white;
    color: #64748b;
    font-size: 13px;
}

/* ================= FILE GRID & CARDS ================= */
.file-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
}

.file-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 20px;
    padding: 24px;
}

.file-info-header {
    display: flex;
    gap: 16px;
    margin-bottom: 20px;
}

.file-icon-box {
    width: 64px;
    height: 64px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Matching colors from image */
.bg-pdf { background-color: #fee2e2; }
.bg-img { background-color: #dcfce7; }

.file-details {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.file-name {
    font-weight: 600;
    color: #1e293b;
    font-size: 15px;
    margin-bottom: 4px;
}

.file-meta {
    font-size: 12px;
    color: #94a3b8;
}

/* ================= ACTION BUTTONS ================= */
.file-actions {
    display: flex;
    gap: 12px;
}

.action-btn {
    flex: 1;
    height: 38px;
    border-radius: 8px;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

.btn-dl { background: #eef2ff; color: #6366f1; }
.btn-sh { background: #f0fdf4; color: #22c55e; }
.btn-del { background: #fef2f2; color: #ef4444; }

</style>

<div class="main-content">
    <div class="files-page">
        <div class="page-header">
            <div class="page-title">
                <h1>My Files</h1>
                <p>Manage and organize all your uploaded files</p>
            </div>
            <button class="upload-btn" onclick="location.href='/upload'">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/></svg>
                Upload Files
            </button>
        </div>

        <div class="stats-bar">
            <div class="stat"><strong id="totalCount">0</strong><span>Total Files</span></div>
            <div class="stat"><strong id="imgCount">0</strong><span>Images</span></div>
            <div class="stat"><strong id="docCount">0</strong><span>Documents</span></div>
            <div class="stat"><strong id="vidCount">0</strong><span>Videos</span></div>
            <div class="stat"><strong id="shareCount">0</strong><span>Shared</span></div>
        </div>

        <div class="filters">
            <input type="text" class="search-box" placeholder="Search files...">
            <div class="filter-group">
                <select class="select"><option>All Types</option></select>
                <select class="select"><option>Date (Newest)</option></select>
            </div>
        </div>

        <div class="file-grid" id="your-files-list">
            </div>
    </div>
</div>

<script type="module">
import { API_BASE } from "/static/js/api.js";

async function loadMyFiles() {
    const token = localStorage.getItem("token");
    const res = await fetch(`${API_BASE}/api/list/`, {
        headers: { Authorization: token },
        credentials: "include"
    });

    const data = await res.json();
    const files = data.files || [];
    
    document.getElementById("totalCount").innerText = files.length;
    const list = document.getElementById("your-files-list");
    list.innerHTML = "";

    files.forEach(f => {
        const isPdf = f.filename.toLowerCase().endsWith('.pdf');
        const iconBg = isPdf ? 'bg-pdf' : 'bg-img';
        const iconUrl = isPdf ? 'https://cdn-icons-png.flaticon.com/512/337/337946.png' : 'https://cdn-icons-png.flaticon.com/512/3342/3342137.png';
        const size = (f.size / (1024 * 1024)).toFixed(2);

        list.innerHTML += `
            <div class="file-card">
                <div class="file-info-header">
                    <div class="file-icon-box ${iconBg}">
                        <img src="${iconUrl}" width="32">
                    </div>
                    <div class="file-details">
                        <div class="file-name">${f.filename}</div>
                        <div class="file-meta">${size} MB â€¢ Today</div>
                    </div>
                </div>
                <div class="file-actions">
                    <button class="action-btn btn-dl" onclick="downloadFile('${f.download_url}')">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/></svg>
                    </button>
                    <button class="action-btn btn-sh" onclick="shareFile('${f.id}')">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/></svg>
                    </button>
                    <button class="action-btn btn-del" onclick="deleteFile('${f.id}')">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg>
                    </button>
                </div>
            </div>
        `;
    });
}

loadMyFiles();
</script>
{% endblock %}