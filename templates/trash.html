{% extends "base.html" %}
{% block content %}
<div class="main">
  <h1>Trash</h1>
  <p>Files here will be permanently deleted after 30 days. You can restore them anytime.</p>

  <table class="dashboard-table">
    <thead>
      <tr>
        <th>Filename</th>
        <th>Deleted On</th>
        <th>Days Remaining</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="trashTable">
      <tr><td colspan="4" style="text-align:center;">Loading...</td></tr>
    </tbody>
  </table>
</div>

<script>
async function deleteFile(id) {
  if (!confirm("âš ï¸ Permanently delete this file? This cannot be undone.")) return;

  const token = localStorage.getItem("token");
  if (!token) {
    alert("Session expired. Please login again.");
    return location.href = "/login";
  }

  try {
    const res = await fetch(`https://dropvault-2.onrender.com/api/delete/${id}/`, {
      method: "DELETE",
      headers: {
        "Authorization": `Bearer ${token}`
      }
    });

    const data = await res.json().catch(() => ({}));

    if (!res.ok) {
      console.error("Delete failed:", data);
      alert(data.message || data.error || "Failed to delete file permanently");
      return;
    }

    alert("ğŸ—‘ï¸ File permanently deleted!");
    loadTrash(); // refresh trash list

  } catch (err) {
    console.error("Permanent delete error:", err);
    alert("âŒ Server error while deleting file");
  }
}
</script>

{% endblock %}