<script>
const API_BASE = "https://dropvault-2.onrender.com";

async function loadSharedFiles() {
  const token = localStorage.getItem("token");

  if (!token) {
    alert("Please login to continue");
    return window.location.href = "/login";
  }

  /*
    ‚ö†Ô∏è Backend does NOT provide a shared-files LIST endpoint.
    So this page loads empty by design.
    Shared links are generated per-file using /api/share/<id>/
  */
  const list = document.getElementById("shared-list");
  list.innerHTML = `
    <tr>
      <td colspan="4" style="text-align:center;">
        Click "Share" from My Files to generate links
      </td>
    </tr>
  `;
}

window.getShare = async (id) => {
  const token = localStorage.getItem("token");

  try {
    const res = await fetch(`${API_BASE}/api/share/${id}/`, {
      method: "GET",
      headers: {
        "Authorization": token   // ‚úÖ REQUIRED (no Bearer)
      }
    });

    if (res.status === 401) {
      alert("Session expired. Please login again.");
      localStorage.removeItem("token");
      return window.location.href = "/login";
    }

    if (!res.ok) {
      alert("Failed to generate share link");
      return;
    }

    const data = await res.json();
    console.log("SHARE RESPONSE:", data);

    if (!data.share_url) {
      alert("Share URL not returned by server");
      return;
    }

    const fullLink = data.share_url.startsWith("http")
      ? data.share_url
      : `${API_BASE}${data.share_url}`;

    navigator.clipboard.writeText(fullLink);
    alert("üîó Link Copied!");
  } catch (err) {
    console.error("Share error:", err);
    alert("Error generating share link");
  }
};

loadSharedFiles();
</script>
