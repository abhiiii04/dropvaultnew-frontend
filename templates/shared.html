{% extends 'base.html' %}
{% block content %}

<div class="shared-wrapper">
  <h1 class="shared-title">Shared Files</h1>
  <p class="shared-subtitle">Files you have shared</p>

  <table class="shared-table">
    <thead>
      <tr>
        <th>Filename</th>
        <th>Expiry</th>
        <th>Status</th>
        <th>Link</th>
      </tr>
    </thead>
    <tbody id="shared-list">
      <tr><td colspan="4">Loading...</td></tr>
    </tbody>
  </table>
</div>

<script type="module">
import { API_BASE } from "/static/js/api.js";

async function loadSharedFiles() {
  const token = localStorage.getItem("token");
  if (!token) return location.href = "/login";

  const res = await fetch(`${API_BASE}/files/shared/`, {
    headers: { "Authorization": token }
  });

  const data = await res.json();
  const list = document.getElementById("shared-list");
  list.innerHTML = "";

  const shared = data.shared || [];

  if (!shared.length) {
    list.innerHTML = "<tr><td colspan='4'>No shared files</td></tr>";
    return;
  }

  shared.forEach(f => {
    const exp = f.expiry ? new Date(f.expiry).toLocaleString() : "-";
    list.innerHTML += `
      <tr>
        <td>${f.filename}</td>
        <td>${exp}</td>
        <td>${new Date(f.expiry) > new Date() ? "Active" : "Expired"}</td>
        <td>
          <button onclick="copyLink('${API_BASE + f.share_url}')">Copy</button>
        </td>
      </tr>
    `;
  });
}

window.copyLink = (url) => {
  navigator.clipboard.writeText(url);
  alert("ðŸ”— Link Copied!");
};

loadSharedFiles();
</script>

{% endblock %}

